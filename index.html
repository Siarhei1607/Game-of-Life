<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <style type="text/css">
        #canvas {
            width: 300;
            height: 300;
            border: 2px solid black;
            margin: 40px;
        }
    </style>
</head>

<body>
<canvas id="canvas" width="300" height="300"></canvas><br>

<label >Высота:</label>
<input type="text" id="heightInput" value="300" />
<label >Ширина:</label>
<input type="text" id="widthInput" value="300" />
<input type="button" value="Создать поле" id="create" />
<p>Таймер: <span id="count">0</span></p>
<button id="start">Start</button>
<button id="pause">Pause</button>
<button id="stop">Stop</button>

<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const widthInput = document.getElementById("widthInput");
    const heightInput = document.getElementById("heightInput");
    const count = document.getElementById('count');
    let width, height, sizeFieldWidth, sizeFieldHeight;

    const sizeCellwidth = 10;
    const sizeCellheight = 10;

    let mas = [];
    let timer;

    canvas.onclick = function(event) {
        let x = event.offsetX;
        let y = event.offsetY;
        x = Math.floor(x / sizeCellwidth);
        y = Math.floor(y / sizeCellheight);
        mas[y][x] = 1;
        drawField();
    };

    function resizeCanvas() {
        canvas.width = widthInput.value;
        canvas.height = heightInput.value;
        width = canvas.width;
        height = canvas.height;
        sizeFieldWidth = width / sizeCellwidth;
        sizeFieldHeight = height / sizeCellheight;
        goLife();
    }

    function goLife() {
        for (let i = 0; i < sizeFieldHeight; i++) {
            mas[i] = [];
            for (let j = 0; j < sizeFieldWidth; j++) {
                mas[i][j] = 0;
            }
        }
    }
    resizeCanvas();

    function drawField() {

        ctx.clearRect(0, 0, width, height);
        for (let i = 0; i < sizeFieldHeight; i++) {
            for (let j = 0; j < sizeFieldWidth; j++) {

                if (mas[i][j] === 1) {
                    ctx.fillRect(j * sizeCellwidth, i * sizeCellheight, sizeCellwidth, sizeCellheight);
                }
            }
        }
    }

    function startLife() {
        let mas2 = [];
        for (let i = 0; i < sizeFieldHeight; i++) {
            mas2[i] = [];
            for (let j = 0; j < sizeFieldWidth; j++) {
                let neighbors = [-1, 1].reduce((a, b) => {
                    b = mas[i + b];
                    if (b === undefined)
                        return a;
                    let num = b[j];
                    if (b[j + 1] !== undefined) {
                        num += b[j + 1]
                    }
                    if (b[j - 1] !== undefined) {
                        num += b[j - 1]
                    }
                    return a + num;
                }, 0);
                neighbors = [-1, 1].reduce((a, b) => a += mas[i][j + b] !== undefined && mas[i][j + b], neighbors);
                mas2[i][j] = +(neighbors === 2 || neighbors === 3)



            }
        }
        mas = mas2;
        drawField();
        count.innerHTML++;
        timer = setTimeout(startLife, 300);
    }

    function pauseLife() {
        clearInterval(timer)
    }

    function stopLife() {
        pauseLife();
        goLife();
        drawField();
        count.innerHTML = 0;
    }

    document.getElementById("create").onclick = resizeCanvas;
    document.getElementById("start").onclick = startLife;
    document.getElementById("pause").onclick = pauseLife;
    document.getElementById("stop").onclick = stopLife;

</script>
</body>

</html>
